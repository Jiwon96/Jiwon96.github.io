---
layout: post
title: "백준 19236번 청소년 상어 - 백트래킹에서 상태 복원의 중요성"
date: 2025-07-06
categories: [Algorithm, 백준]
tags: [백트래킹, DFS, Python, 상태복원]
---

# 백준 19236번 청소년 상어 - 백트래킹에서 상태 복원의 중요성

## 들어가며
DFS 백트래킹 문제를 풀면서 겪었던 여러 실수들과 핵심 깨달음을 공유합니다. 특히 상태 복원의 중요성을 간과했던 경험을 중심으로 정리했습니다.

## 문제 분석
- 4×4 격자에서 물고기들이 각자의 방향으로 이동
- 상어가 물고기를 잡으며 최대 점수 획득
- **핵심**: 상어 이동 → 물고기들 순서대로 이동 → 상어 이동... 반복

## 초기 접근에서의 실수들

### 1. Python 기본 문법 혼동
**튜플 관련 실수들:**
```python
# 잘못된 접근
(1,2,3) + (3)     # TypeError 발생
t[3] = 1          # 튜플은 불변!

# 올바른 접근  
(1,2,3) + (3,)    # (1, 2, 3, 3)
t = t + (new,)    # 새로운 튜플 생성
```

**핵심 개념:**
- `(3)`은 정수, `(3,)`은 튜플
- 튜플 연산은 항상 새로운 객체 생성
- 요소 추가가 빈번하면 리스트 사용 고려

### 2. 전역변수 vs 지역변수 문제
```python
def dfs():
    # 문제가 된 코드
    fish = t_fish  # 이 순간 fish가 지역변수가 됨!
    
# 해결 방법
def dfs():
    global fish  # 명시적 선언 필요
```
- Python LEGB 규칙: 함수 내 할당문이 있으면 지역변수로 간주
- 전역변수 수정 시 반드시 `global` 선언

### 3. **가장 중요한 문제: 백트래킹 상태 복원 미고려**

## 핵심 문제: 왜 물고기 좌표도 백트래킹해야 하는가?

### 문제 상황 파악
**처음 놓친 핵심**: "DFS로 다른 경로를 탐색할 때, 이전 경로에서 변경된 물고기 좌표가 그대로 남아있다"

### 구체적인 예시
```
i-th 상태: 물고기 1번(1,1), 2번(2,2), 3번(3,3)
│
├─ 상어가 경로1 선택
│  ├─ 상어 이동 후 move 함수 실행 → 1번(1,2), 2번(2,1), 3번(3,1)
│  ├─ 다음 상어 이동 및 탐색 완료
│  └─ 백트래킹 시점 ⚠️
│
└─ 상어가 경로2 선택하려 할 때
   ├─ 물고기들이 (1,2), (2,1), (3,1)에서 시작? ❌ 틀렸다!
   └─ 물고기들이 (1,1), (2,2), (3,3)에서 시작? ⭕ 맞다!
```

### **핵심 깨달음**
- **"상어의 움직임 이후 물고기들이 움직이기 때문에 물고기 좌표는 달라져 있다"**
- 첫 번째 DFS 경로에서 상어가 이동한 후 move 함수가 물고기들을 이동시킨 결과가 남아있음
- 두 번째 경로 탐색 시 **i-th 상태가 아닌 변경된 상태**에서 시작하게 됨
- **이를 고려한다면 백트래킹이 반드시 필요했다**

### 잘못된 접근의 결과
- 각 DFS 경로가 독립적이지 않음
- 이전 경로의 물고기 이동 결과가 다음 경로에 영향
- **최적해를 놓치거나 잘못된 답 도출**

## 올바른 해결 방법

### 완전한 상태 복원
```python
def dfs(s, shark, fish, board):
    # 현재 상태 저장 (핵심!)
    t_fish = [l[:] for l in fish]
    t_board = [l[:] for l in board]
    
    # 물고기 이동
    for idx in range(1, 17):
        if fish[idx][3]: continue
        move(idx, shark, fish, board)
    
    # 상어의 각 가능한 이동에 대해
    for i in range(1, 4):
        # 상어 이동 가능 여부 체크
        if 조건_만족:
            # 상어 이동 및 재귀 호출
            dfs(...)
            
            # 상태 복원 (핵심!)
            fish[:] = [l[:] for l in t_fish]
            board[:] = [l[:] for l in t_board]
```

### 핵심 포인트
1. **매 DFS 호출마다 현재 상태 저장**
2. **재귀 호출 후 반드시 상태 복원**
3. **독립적인 경로 탐색 보장**

## 핵심 교훈
1. **DFS 백트래킹 = 모든 상태의 완전한 복원**
2. **"상태 변화 후 다른 경로 탐색"을 항상 고려하자**
3. **문제의 실행 순서를 정확히 파악하자**
4. **Python 기본 문법도 확실히 익히자**

## 마무리
백트래킹 문제에서는 단순히 값만 복원하는 것이 아니라, **모든 관련 상태를 원복**해야 합니다. 특히 이 문제처럼 객체들의 위치가 계속 변하는 상황에서는 더욱 주의깊게 상태 관리를 해야 합니다.
